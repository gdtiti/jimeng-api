# 即梦AI项目进程管理器使用说明

## 📋 已创建的进程管理工具

我已经为您创建了三个强大的进程管理工具：

### 1. process-manager.bat (批处理脚本)
- **功能最完整**的命令行界面
- 支持交互式菜单操作
- 包含完整的进程管理功能

### 2. process-manager.ps1 (PowerShell脚本)
- **功能最强大**的脚本
- 支持彩色输出和详细状态显示
- 支持命令行参数和交互模式

### 3. quick-cleanup.bat (快速清理脚本)
- **最简单快捷**的清理工具
- 一键关闭所有项目进程
- 适合快速重置环境

## 🚀 使用方法

### 方法1: 批处理脚本 (推荐Windows用户)
```bash
# 进入项目目录
cd J:\_Photos\_jimengxdreamina-api

# 运行进程管理器
.\process-manager.bat
```

### 方法2: PowerShell脚本 (推荐高级用户)
```powershell
# 进入项目目录
cd J:\_Photos\_jimengxdreamina-api

# 运行进程管理器 (交互模式)
.\process-manager.ps1

# 或者直接使用命令 (非交互模式)
.\process-manager.ps1 -Action status
.\process-manager.ps1 -Action stop -Force
.\process-manager.ps1 -Action restart
```

### 方法3: 快速清理 (一键重置)
```bash
# 进入项目目录
cd J:\_Photos\_jimengxdreamina-api

# 快速清理所有进程
.\quick-cleanup.bat
```

## 📖 功能详解

### process-manager.bat 功能菜单

| 选项 | 功能 | 说明 |
|------|------|------|
| 1 | 查看当前运行状态 | 检查所有服务和端口占用情况 |
| 2 | 关闭所有项目进程 | 安全关闭所有相关进程 |
| 3 | 启动后端API服务器 | 启动调试服务器(端口4000) |
| 4 | 启动前端开发服务器 | 自动寻找可用端口启动 |
| 5 | 重启所有服务 | 关闭现有服务后重新启动 |
| 6 | 检查端口占用情况 | 详细显示端口占用信息 |
| 7 | 清理僵尸进程 | 清理无法正常关闭的进程 |
| 8 | 完整环境重置 | 清理所有进程和缓存文件 |
| 0 | 退出 | 退出程序 |

### PowerShell脚本命令行参数

```powershell
# 显示交互式菜单
.\process-manager.ps1

# 查看当前状态
.\process-manager.ps1 -Action status

# 关闭所有进程 (跳过确认)
.\process-manager.ps1 -Action stop -Force

# 启动后端服务器
.\process-manager.ps1 -Action start-backend

# 启动前端服务器
.\process-manager.ps1 -Action start-frontend

# 重启所有服务
.\process-manager.ps1 -Action restart -Force

# 清理僵尸进程
.\process-manager.ps1 -Action clean

# 完整环境重置
.\process-manager.ps1 -Action reset -Force
```

## 🔧 解决的问题

### 当前状态
您目前有**大量运行中的进程**：
- 多个调试服务器实例 (debug-server.cjs)
- 多个前端开发服务器实例 (npm run dev)
- 多个测试服务器实例 (test-ui-server.cjs)
- 完整的生产服务器实例 (npm start)

### 推荐操作步骤

1. **立即清理所有进程**：
   ```bash
   .\quick-cleanup.bat
   ```

2. **使用调试服务器** (推荐开发和测试)：
   ```bash
   .\process-manager.bat
   # 选择选项 3 启动后端，选项 4 启动前端
   ```

3. **或者使用PowerShell进行精细控制**：
   ```powershell
   .\process-manager.ps1 -Action status
   .\process-manager.ps1 -Action restart -Force
   ```

## 🛠️ SQLite3问题解决方案

### 问题说明
您遇到的SQLite3错误是因为：
- 完整的生产服务器需要编译SQLite3的本地模块
- 当前Node.js版本(23.11.0)可能没有对应的预编译模块
- 编译需要Visual Studio Build Tools

### 解决方案

#### 方案1: 使用调试服务器 (推荐)
```bash
# 关闭所有进程
.\quick-cleanup.bat

# 启动调试服务器
node debug-server.cjs
```

#### 方案2: 重新安装SQLite3
```bash
# 关闭所有进程
.\quick-cleanup.bat

# 重新安装SQLite3
npm rebuild sqlite3

# 或者降级到兼容版本
npm install sqlite3@5.1.6
```

#### 方案3: 使用Docker (推荐生产环境)
```bash
# 构建Docker镜像
docker build -t jimeng-api .

# 运行容器
docker run -p 4000:4000 jimeng-api
```

## 📝 最佳实践建议

### 开发环境
1. **使用调试服务器** - `node debug-server.cjs`
2. **进程管理** - 使用`process-manager.bat`
3. **快速重置** - 使用`quick-cleanup.bat`

### 生产环境
1. **解决SQLite3问题** - 重新编译或使用Docker
2. **进程监控** - 使用PowerShell脚本
3. **环境隔离** - 使用Docker容器

### 故障排除
1. **端口被占用** - 使用清理脚本或检查端口功能
2. **进程无法关闭** - 使用完整重置功能
3. **服务启动失败** - 检查端口占用和权限问题

## 🎯 使用示例

### 典型的开发工作流
```bash
# 1. 清理环境
.\quick-cleanup.bat

# 2. 启动服务
.\process-manager.bat
# 选择 3 (启动后端)
# 选择 4 (启动前端)

# 3. 测试功能
# 访问 http://localhost:4000 和 http://localhost:3010

# 4. 需要重置时
.\quick-cleanup.bat
# 然后重新启动
```

### 高级用户工作流
```powershell
# 1. 检查状态
.\process-manager.ps1 -Action status

# 2. 一键重启
.\process-manager.ps1 -Action restart -Force

# 3. 监控进程
Get-Process | Where-Object {$_.MainWindowTitle -like "*jimeng*"}

# 4. 清理僵尸进程
.\process-manager.ps1 -Action clean
```

现在您可以使用这些工具轻松管理所有项目进程了！🚀