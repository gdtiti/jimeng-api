# 环境变量加载状态说明

## 概述

项目在启动时会自动加载并显示环境变量的详细状态，帮助您快速了解配置情况。

## 🚀 启动时显示内容

### 1. 基础信息
```
📦 环境变量加载状态
==================================================
📄 环境文件: .env
📊 已加载变量数: 4/22
```

### 2. 分类配置显示

#### 🖥️ 基础服务配置
- **NODE_ENV**: Node.js 运行环境
- **SERVER_HOST**: 服务器主机地址
- **SERVER_PORT**: 服务器端口

#### 🌐 URL配置
- **JIMENG_CN_URLS**: 即梦中国API地址
- **JIMENG_US_URLS**: 即梦国际API地址
- **DREAMINA_CN_PROXY**: 即梦中国代理地址
- **DREAMINA_US_PROXY**: 即梦国际代理地址

#### 🔐 认证配置
- **DEFAULT_TOKEN_CN**: 默认中国版Token
- **DEFAULT_TOKEN_US**: 默认国际版Token

#### ☁️ AWS配置
- **AWS_ACCESS_KEY_ID**: AWS访问密钥ID
- **AWS_SECRET_ACCESS_KEY**: AWS秘密访问密钥
- **AWS_REGION**: AWS区域
- **AWS_S3_BUCKET**: AWS S3存储桶名称

#### 🛡️ 安全配置
- **CORS_ORIGINS**: CORS允许的源地址
- **RATE_LIMIT_ENABLED**: 是否启用速率限制
- **RATE_LIMIT_MAX**: 速率限制最大请求数

#### 📝 日志配置
- **LOG_LEVEL**: 日志级别
- **LOG_FILE_ENABLED**: 是否启用文件日志

#### ⚡ 性能配置
- **CACHE_ENABLED**: 是否启用缓存
- **CACHE_TTL**: 缓存过期时间

#### 🔧 其他配置
- **DATABASE_URL**: 数据库连接URL
- **API_KEY**: API密钥

### 3. 状态指示说明

- **✅ 已设置**: 环境变量已正确配置
- **⚡ 使用默认值**: 未设置，使用系统默认值
- **⚪ 未设置**: 可选配置项未设置
- **❌ 缺少必需**: 必需变量未设置（会导致启动失败）

### 4. URL汇总信息
```
🌐 API地址汇总:
  🇨🇳 中国版API: https://jimeng.jianying.com
  🇨🇳 中国版代理: https://jimeng.jianying.com/tech
  🌍 国际版API: https://api-proxy-1.deno.dev/dreamina/us;https://dreamina-api.us.capcut.com
  🌍 国际版代理: https://api-proxy-1.deno.dev/dreamina/us
  📊 负载均衡: 中国版1个地址, 国际版2个地址
```

### 5. 安全特性

敏感信息（如密钥、Token等）会自动进行掩码处理：
```
✅ AWS_ACCESS_KEY_ID: AKI***123 (AWS访问密钥ID)
✅ DEFAULT_TOKEN_CN: abc***xyz (默认中国版Token)
```

## 📁 环境文件加载顺序

系统按以下顺序查找并加载环境变量文件：

1. `.env.local` - 本地特定配置（优先级最高）
2. `.env.development` - 开发环境配置
3. `.env` - 通用配置
4. `.env.example` - 示例配置

## ⚙️ 配置建议

### 开发环境
```bash
# 复制示例配置
cp .env.example .env

# 修改必要配置
NODE_ENV=development
PORT=5566
LOG_LEVEL=debug
```

### 生产环境
```bash
# 设置所有必需变量
NODE_ENV=production
PORT=5566
JIMENG_CN_URLS=https://jimeng.jianying.com
JIMENG_US_URLS=https://api-proxy-1.deno.dev/dreamina/us;https://backup-api.example.com
LOG_LEVEL=info
RATE_LIMIT_ENABLED=true
```

## 🔍 故障排除

### 1. 环境文件未找到
```
⚠️ 未找到环境变量文件，使用系统环境变量
```
**解决方案**: 检查是否存在 `.env` 文件

### 2. 必需变量缺失
```
❌ 配置验证失败:
  - 缺少必需的环境变量: NODE_ENV
```
**解决方案**: 在 `.env` 文件中添加缺失的变量

### 3. URL格式错误
```
⚠️ 配置警告:
  - 环境变量 JIMENG_US_URLS 的URL格式可能不正确
```
**解决方案**: 确保URL格式正确，支持多个URL用分号分隔

## 📊 示例输出

### 完整的启动日志
```
[2025-10-21 03:19:21.586] [success] Server initialized
[dotenv@17.2.3] injecting env (19) from .env
[2025-10-21 03:19:21.598] [info] 成功加载环境变量文件: .env
[2025-10-21 03:19:21.600] [info] <<<< jimeng free server >>>>
[2025-10-21 03:19:21.600] [info] Version: 1.3.0
[2025-10-21 03:19:21.601] [info] Process id: 28008
[2025-10-21 03:19:21.601] [info] Environment: dev
[2025-10-21 03:19:21.601] [info] Service name: jimeng-free-api

📦 环境变量加载状态
==================================================
📄 环境文件: .env
📊 已加载变量数: 4/22

🖥️  基础服务配置
  ✅ NODE_ENV: development (Node.js 运行环境)
  ⚡ SERVER_HOST: [默认: 0.0.0.0] (服务器主机地址)
  ⚡ SERVER_PORT: [默认: 3000] (服务器端口)

🌐 URL配置
  ✅ JIMENG_CN_URLS: https://jimeng.jianying.com
  ✅ JIMENG_US_URLS: https://api-proxy-1.deno.dev/dreamina/us;https://dreamina-api.us.capcut.com
  ⚡ DREAMINA_CN_PROXY: [默认: https://jimeng.jianying.com/tech]
  ⚡ DREAMINA_US_PROXY: [默认: https://api-proxy-1.deno.dev/dreamina/us]

🔍 必需变量检查:
  ✅ 所有必需变量都已设置

🌐 API地址汇总:
  🇨🇳 中国版API: https://jimeng.jianying.com
  🇨🇳 中国版代理: https://jimeng.jianying.com/tech
  🌍 国际版API: https://api-proxy-1.deno.dev/dreamina/us;https://dreamina-api.us.capcut.com
  🌍 国际版代理: https://api-proxy-1.deno.dev/dreamina/us
  📊 负载均衡: 中国版1个地址, 国际版2个地址
==================================================

[2025-10-21 03:19:21.614] [success] Service bind address: http://0.0.0.0:5100
[2025-10-21 03:19:21.615] [success] Service startup completed (31ms)
```

## 🎯 总结

环境变量加载状态功能提供了：

- ✅ **完整的配置概览**: 清晰显示所有配置项
- ✅ **状态指示**: 直观显示每个配置项的状态
- ✅ **安全保护**: 敏感信息自动掩码
- ✅ **错误检测**: 自动发现配置问题
- ✅ **URL汇总**: 显示负载均衡配置
- ✅ **加载顺序**: 支持多种环境文件

通过这个功能，您可以快速了解项目的配置状态，确保所有必要的设置都正确配置。