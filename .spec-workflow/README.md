# 即梦API接口文档

## 文档概述

本文档集详细分析了当前项目使用的即梦国际和即梦中国的所有API接口���包括接口参数、响应结构、头部构建、cookies管理等完整信息。

## 文档结构

### 核心接口文档

1. **[获取上传令牌接口文档](./接口文档/获取上传令牌接口.md)**
   - 获取图片上传所需的AWS S3认证令牌
   - 支持即梦中国和即梦国际两个版本

2. **[申请图片上传权限接口文档](./接口文档/申请图片上传权限接口.md)**
   - 申请具体的图片上传权限，获取上传地址
   - 包含AWS4-HMAC-SHA256签名生成流程

3. **[图片文件上传接口文档](./接口文档/图片文件上传接口.md)**
   - 上传图片文件到ImageX存储服务器
   - 包含CRC32校验和性能优化建议

4. **[提交图片上传接口文档](./接口文档/提交图片上传接口.md)**
   - 确认上传完成，获取最终图片URI
   - 包含错误处理和故障排查指南

### AIGC生成接口

5. **[AIGC草稿��成接口文档](./接口文档/AIGC草稿生成接口.md)**
   - 创建图片生成、视频生成、图生图任务
   - 包含完整的模型映射和参数说明

6. **[历史记录查询接口文档](./接口文档/历史记录查询接口.md)**
   - 查询生成任务状态和结果
   - 包含智能轮询策略和结果提取方法

### 用户管理接口

7. **[积分信息查询接口文档](./接口文档/积分信息查询接口.md)**
   - 查询用户积分状态和消费记录
   - 包含积分类型说明和消费优先级

8. **[接收积分接口文档](./接口文档/接收积分接口.md)**
   - 领取每日积分奖励
   - 包含时区处理和连续奖励机制

9. **[用户账户信息接口文档](./接口文档/用户账户信息接口.md)**
   - 验证token有效性，获取用户信息
   - 包含权限检查和批量验证功能

### 综合文档

10. **[即梦API接口使用总结](./接口文档/即梦API接口使用总结.md)**
    - 所有接口的完整使用指南
    - 包含最佳实践、错误处理、性能优化建议

## 关键特性

### 支持的功能
- ✅ 图片生成（文本生成图片）
- ✅ 视频生成（文本生成视频）
- ✅ 图生图（图片生成图片）
- ✅ 多图生成（连续图片生成）
- ✅ 图片上传和处理
- ✅ 积分管理
- ✅ 用户权限验证

### 地区支持
- 🇨🇳 **即梦中国**: `https://jimeng.jianying.com`
- 🌍 **即梦国际**: `https://api-proxy-1.deno.dev/dreamina/us`

### SessionID管理
- **中国版**: 直接使用refreshToken作为sessionid
- **国际版**: 使用去掉"us-"前缀的refreshToken作为sessionid

### 模型支持

#### 图片生成模型
- `jimeng-4.0`: 最新图片生成模型
- `jimeng-3.1`: 3.1版本模型
- `jimeng-3.0`: 3.0版本模型
- `jimeng-2.1`: 2.1版本模型
- `jimeng-2.0-pro`: 2.0 Pro版本
- `jimeng-2.0`: 2.0版本模型
- `jimeng-1.4`: 1.4版本模型
- `jimeng-xl-pro`: XL Pro模型

#### 视频生成模型
- `jimeng-video-3.0-pro`: 视频生成3.0 Pro
- `jimeng-video-3.0`: 视频生成3.0
- `jimeng-video-2.0`: 视频生成2.0
- `jimeng-video-2.0-pro`: 视频生成2.0 Pro

## 快速开始

### 1. 环境准备

```bash
# 安装依赖
npm install axios crypto lodash mime

# 配置环境变量
export JIMENG_BASE_URL="https://jimeng.jianying.com"
export JIMENG_AID="513695"
```

### 2. 基础使用

```javascript
import { generateImages } from './src/api/controllers/images';

// 生成图片
const imageUrls = await generateImages(
  'jimeng-4.0',
  '一只可爱的猫咪在花园里玩耍',
  { ratio: '1:1', resolution: '2k' },
  'your_refresh_token'
);

console.log('生成的图片URL:', imageUrls);
```

### 3. 视频生成

```javascript
import { generateVideo } from './src/api/controllers/videos';

// 生成视频
const videoUrl = await generateVideo(
  'jimeng-video-3.0',
  '夕阳下的海滩，海浪轻柔地拍打着沙滩',
  { width: 1024, height: 1024 },
  'your_refresh_token'
);

console.log('生成的视频URL:', videoUrl);
```

## 配置说明

### 通用配置
- `PLATFORM_CODE`: 平台代码，固定为"7"
- `VERSION_CODE`: 版本代码，固定为"1.0.0"
- `WEB_VERSION`: Web版本，默认"7.5.0"
- `DA_VERSION`: DA版本，默认"3.3.2"
- `AIGC_FEATURES`: AIGC功能，默认"app_lip_sync"

### 重试配置
- `MAX_RETRY_COUNT`: 最大重试次数，默认3次
- `RETRY_DELAY`: 重试延迟，默认5000ms

### 轮询配置
- `MAX_POLL_COUNT`: 最大轮询次数，默认900次（15分钟）
- `POLL_INTERVAL`: 轮询间隔，默认1000ms

## 错误处理

### 常见错误码
- `0`: 成功
- `2001`: 用户不存在或token无效
- `2002`: 参数错误
- `2003`: 服务繁忙
- `2004`: 权限不足
- `2038`: 内容被过滤

### 重试机制
项目实现了智能重试机制：
- 网络错误自动重试
- 指数退避算法
- 最大重试次数限制

## 性能优化

### 缓存策略
- 用户信息缓存10分钟
- 积分信息缓存30秒
- 生成结果根据状态设置不同缓存时间

### 并发控制
- 图片上传并发数不超过3个
- API查询并发数不超过5个
- 实现请求队列管理

## 监控和日志

### 关键指标
- API请求成功率
- 平均响应时间
- 生成任务完成率
- 积分消费统计

### 日志级别
- `info`: 正常操作日志
- `warn`: 警告信息
- `error`: 错误信息

## 安全考虑

1. **Token保护**: 严格保护refreshToken，避免在日志中泄露
2. **HTTPS传输**: 所有API请求必须使用HTTPS
3. **参数验证**: 严格验证所有输入参数
4. **频率限制**: 实现合理的请求频率控制
5. **错误处理**: 避免在错误信息中泄露敏感数据

## 开发建议

### 1. 代码规范
- 使用TypeScript进行类型检查
- 遵循ESLint规则
- 添加适当的注释和文档

### 2. 测试策略
- 编写单元测试
- 实现集成测试
- 添加错误场景测试

### 3. 部署建议
- 使用环境变量管理配置
- 实现健康检查接口
- 添加监控和告警

## 更新日志

### v1.0.0 (2025-01-21)
- ✅ 完成所有核心接口文档
- ✅ 添加即梦国际版本支持
- ✅ 实现完整的错误处理机制
- ✅ 添加性能优化建议
- ✅ 提供完整的使用示例

## 贡献指南

1. Fork项目
2. 创建功能分支
3. 提交代码变更
4. 推送到分支
5. 创建Pull Request

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 联系方式

如有问题或建议，请通过以下方式联系：

- 创建GitHub Issue
- 发送邮件至开发团队
- 加入技术交流群

---

**注意**: 本文档基于当前代码分析生成，实际API可能会有更新。建议定期检查官方文档和API变更通知。